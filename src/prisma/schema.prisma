generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  chat_id         Int            @id
  model_id        Int?
  subscription_id Int?
  Requests        Requests[]
  Model           Model?         @relation(fields: [model_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Subscriptions   Subscriptions? @relation(fields: [subscription_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Messages        Messages[]
  Referals        Referals[]
}

model Model {
  id             Int              @id
  name           String?
  family         String?          @default("chat")
  Requests       Requests[]
  Users          Users[]
  Limits         Limits[]
  ReferalBonuses ReferalBonuses[]
}

model Requests {
  id       Int    @id @default(autoincrement())
  chat_id  Int?
  count    Int?   @default(0)
  model_id Int?
  Users    Users? @relation(fields: [chat_id], references: [chat_id], onDelete: NoAction, onUpdate: NoAction)
  Model    Model? @relation(fields: [model_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_requests_models")
}

model Subscriptions {
  id     Int      @id
  name   String?
  price  Int?
  Users  Users[]
  Limits Limits[]
}

model Limits {
  model_id        Int
  subscription_id Int
  limits          Int?
  Subscriptions   Subscriptions? @relation(fields: [subscription_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Model           Model?         @relation(fields: [model_id], references: [id], map: "fk_limits_models")

  @@id([model_id, subscription_id])
}

model Messages {
  id      Int    @id @default(autoincrement())
  chat_id Int
  Users   Users? @relation(fields: [chat_id], references: [chat_id])
  text    String
}

model Referals {
  reffed_by Int
  chat_id   Int
  Users     Users @relation(fields: [chat_id], references: [chat_id])

  @@id([reffed_by, chat_id])
}

model ReferalBonuses {
  id       Int   @id @default(autoincrement())
  model_id Int
  Model    Model @relation(fields: [model_id], references: [id])
}
